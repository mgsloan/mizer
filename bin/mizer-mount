#!/usr/bin/env bash
set -e

lower=$GIT_MIZER_BASE
upper=$GIT_MIZER_DIR/upper/$GIT_MIZER_VARIANT
work=$GIT_MIZER_DIR/work/$GIT_MIZER_VARIANT
target=$GIT_MIZER_TARGET

mkdir -p $upper $work $target

mount -t overlay overlay -o lowerdir=$lower,upperdir=$upper,workdir=$work $target

cd $target/..
# Gross hack to set initial PS1 https://serverfault.com/a/586272
bash --init-file <(echo "source \"$HOME/.bashrc\"; PS1=\"[\\\$GIT_MIZER_VARIANT] \$PS1\"")
